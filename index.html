<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quét EAN</title>

<style>
body {
  font-family: Arial;
  padding: 16px;
}
.price {
  font-size: 22px;
  font-weight: bold;
  color: #d32f2f;
}
</style>
</head>

<body>

<h2>Quét / nhập mã EAN13</h2>

<!-- CÁCH 1: CAMERA (ỔN ĐỊNH NHẤT) -->
<input
  type="file"
  accept="image/*"
  capture="environment"
  onchange="scanImage(this.files[0])"
/>

<hr>

<!-- CÁCH 2: NHẬP TAY -->
<input
  id="manual"
  placeholder="Nhập EAN13"
  inputmode="numeric"
/>
<button onclick="lookupManual()">Tra thủ công</button>

<hr>

<div>Mã: <span id="ean">-</span></div>
<div>Tên: <span id="name">-</span></div>
<div class="price" id="price">-</div>
<div id="msg"></div>

<script src="https://unpkg.com/@zxing/library@latest"></script>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw-Qhp1D8B28HFUoRAPYvh-56i2_nIckGB7SuggxmTjWyVJNjzlB70EQ6mUbZwGem_bWw/exec";

function formatVND(v) {
  return Number(v).toLocaleString("vi-VN") + " VNĐ";
}

// QUÉT TỪ ẢNH (camera)
async function scanImage(file) {
  const reader = new ZXing.BrowserBarcodeReader();
  const img = URL.createObjectURL(file);

  try {
    const result = await reader.decodeFromImageUrl(img);
    lookup(result.text);
  } catch (e) {
    document.getElementById("msg").innerText = "Không đọc được mã";
  }
}

// NHẬP TAY
function lookupManual() {
  const ean = document.getElementById("manual").value.trim();
  if (/^\d{13}$/.test(ean)) lookup(ean);
}

async function lookup(ean) {
  document.getElementById("ean").innerText = ean;

  const res = await fetch(API_URL + "?ean=" + ean);
  const data = await res.json();

  if (data.ok) {
    document.getElementById("name").innerText = data.name;
    document.getElementById("price").innerText = formatVND(data.price);
    document.getElementById("msg").innerText = "✔️ OK";
  } else {
    document.getElementById("msg").innerText = "❌ Không tìm thấy";
  }
}
</script>

</body>
</html>
